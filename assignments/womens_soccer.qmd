---
title: "Women's Soccer Data"
---

We'll use this notebook to explore some NCAA women's soccer data and [our questions](https://docs.google.com/spreadsheets/d/1G1AjH2iS6kj3kKHCRi0XVy5Lcm-rahJkeTAToVh9J1g/edit?gid=0#gid=0). First, let's load the tidyverse library:

```{r}
library(tidyverse)
```

We'll want to start with 2025 match data, which is located in [this GitHub repository](https://github.com/dwillis/NCAAWomensSoccerData). We can load the match data directly from GitHub using `read_csv`:


```{r}
matches_2025 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv") |>  mutate(goal_diff = team_score - opponent_score, total_goals = goals + defensive_goals)
```

Let's take a look at this data to see what it contains, using `head` and `glimpse`:

```{r}
head(matches_2025)
glimpse(matches_2025)
```

Now, onto the questions using aggregates, which means `group_by` and `summarize`:

1. How many shots in total has Maryland attempted and how many have been on goal? Calculate a percentage of shots on goal.

```{r}
 matches_2025 |> 
 # filter(team == "Maryland Terrapins, Terps") |> 
  group_by(team) |> 
  summarise(
    total_shots = sum(sh_att),
    total_sog = sum(so_g),
    sog_pct = total_sog/total_shots * 100
  ) |> 
arrange(desc(sog_pct))
```
The Terps had 83 shots, and 45 on goal for a percentage of 54.2.

2. What about the same shot stats from last season's first four games? You'll need to load the matches from 2024 - just change the season in the URL - and filter by date to find the first four games.

```{r}
matches_2024 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2024.csv")


matches_2024 |> 
filter(team == "Maryland Terrapins, Terps", 
         date >= as.Date("2024-08-15") & date <= as.Date("2024-08-25")
  ) |> 
   summarise(
    total_shots = sum(sh_att),
    total_sog = sum(so_g),
    sog_pct = total_sog/total_shots * 100
  ) 

```
In the first four games of 2024 the Terps put up 38 shots and 20 on goal for a percentage of 52%

3. Maryland started 2022 with 4 draws. Have any other teams had as many this season?

```{r}
matches_2025 |> 
  filter(outcome == "Draw") |> 
  group_by(team) |> 
  summarise(
  draws = n()
  ) |> 
  arrange(desc(draws))
```
Yes Cal Poly is leading the country with five draws (in more games obviously). 

4. How many total corner kicks has Maryland had so far this season and how many have its opponents have? Calculate the difference between the two totals for every team using group_by, summarize and mutate, then filter to find Maryland's totals.

```{r}
corners_2025 <- matches_2025 |> 
  group_by(team) |> 
  summarise(
    off_corners = sum(corners),
    def_corners = sum(defensive_corners),
  ) |> 
  mutate(diff_corners= off_corners-def_corners)
```
Maryland has won 28 offensive corners while allowing 22 for a positive differential of six. 

5. What's the most interesting thing you've seen from these questions?

```{r}
swac_teams <- c("Alabama A&M Bulldogs", "Alabama St. Lady Hornets", "Alcorn Lady Braves", "Ark.-Pine Bluff Lady Lions", "Grambling Lady Tigers", "Jackson St. Lady Tigers", "Mississippi Val. Devilettes", "Prairie View Lady Panthers", "Southern U. Lady Jaguars", "Texas Southern Lady Tigers")

swac_matches <- matches_2025 |> 
  filter(team %in% swac_teams)

matches_2025 |> 
  summarise(
    mean_diff = mean(goal_diff),
    mean_opp_goals = mean(defensive_goals),
    mean_sog = mean(so_g),
    mean_opp_sog = mean(defensive_so_g)
    )
swac_matches |> 
  summarise(
    mean_diff = mean(goal_diff),
    mean_opp_goals = mean(defensive_goals),
    mean_sog = mean(so_g),
    mean_opp_sog = mean(defensive_so_g)
    )
big10 <- c("Nebraska Huskers", "Iowa Hawkeyes", "Minnesota Golden Gophers", "Illinois Fighting Illini", "Northwestern Wildcats", "Wisconsin Badgers", "Indiana Hoosiers", "Purdue Boilermakers", "Ohio St. Buckeyes", "Michigan Wolverines", "Michigan St. Spartans", "Penn St. Nittany Lions", "Rutgers Scarlet Knights", "Maryland Terrapins, Terps", "Southern California Trojans", "UCLA Bruins", "Washington Huskies", "Oregon Ducks")

big10_matches <- matches_2025 |> 
  filter(team %in% big10)

big10_matches |> 
  summarise(
    mean_diff = mean(goal_diff),
    mean_opp_goals = mean(defensive_goals),
    mean_sog = mean(so_g),
    mean_opp_sog = mean(defensive_so_g)
  )
big10_matches |> 
  filter (team == "Maryland Terrapins, Terps") |> 
  summarise(
    mean_diff = mean(goal_diff),
    mean_opp_goals = mean(defensive_goals),
    mean_sog = mean(so_g),
    mean_opp_sog = mean(defensive_so_g)
  )

```


The most interesting thing I've found in these questions is a coorelation between the teams with the best corner differential and teams with positive records. The top five teams in corner differential have just two losses between them and both are to Illinois, who interestingly enough are undefeated with a corner differential of -12. I think this could lead to an interesting story on Illinois's tactics, do they prioritize building attacks through the middle? Are they more willing to concede corners defensively? I think these could be interesting things to look at through game tape and/or questions with their coach.



NEW ASSIGNMENT 9/18


```{r}

matches_2025 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv") |>  mutate(goal_diff = team_score - opponent_score, total_goals = goals + defensive_goals)

matches_2024 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2024.csv") |>  mutate(goal_diff = team_score - opponent_score, total_goals = goals + defensive_goals) |> filter(date < '2024-09-18' )

```
t-test

```{r}
t.test(matches_2024$total_goals, matches_2025$total_goals)
```


## Correlations

```{r}
library(tidyverse)


correlations <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2024.csv") 
```

```{r}
newcorrelations <- correlations |> 
  mutate(
    differential = goals - defensive_goals
    )

newcorrelations |> summarise(correlation = cor(differential, fouls, method="pearson"))
```

```{r}
newcorrelations |> summarise(correlation = cor(differential, yellow_cards, method="pearson"))
```

```{r}
fit <- lm(differential ~ fouls, data = newcorrelations)
summary(fit)
```

```{r}
newcorrelations |> 
  summarise(correlation = cor(differential, so_g, method="pearson"))
```

```{r}
net <- lm(differential ~ so_g, data = newcorrelations)
summary(net)
```

```{r}
correlations25 <- read_csv("https://raw.githubusercontent.com/dwillis/NCAAWomensSoccerData/main/data/ncaa_womens_soccer_matchstats_2025.csv") 
```

```{r}
newcorrelations25 <- correlations25 |> 
  mutate(
    differential = goals - defensive_goals
    )
```


```{r}
newcorrelations25 |> summarise(correlation = cor(differential, fouls, method="pearson"))
```

```{r}
newcorrelations25 |> summarise(correlation = cor(differential, yellow_cards, method="pearson"))
```

```{r}
newcorrelations25 <- newcorrelations25 |> 
  mutate(sog_pct =so_g/sh_att)
```

```{r}
newcorrelations25 |> summarise(correlation = cor(differential, sog_pct, method="pearson", use = "complete.obs"))
```

```{r}
newcorrelations25 |> summarise(correlation = cor(differential, defensive_so_g, method="pearson", use = "complete.obs"))
```
```{r}
newcorrelations25 |> 
  filter(team == "Maryland Terrapins, Terps") |> 
  summarise (mean_defsog = mean(defensive_so_g))

newcorrelations25 |> 
  summarise(mean_defsog = mean(defensive_so_g))
```

```{r}
defensive_model <- lm(differential ~ defensive_so_g, data = newcorrelations25)
summary(defensive_model)


```

```{r}
(-0.437064 * 5.5) + 2.8170
```


With Maryland women's soccer off to an improved start in Big Ten play (already doubling their conference win total from last season), it is interesting to see what areas they are succeeding at (erelative to previous years). Across women's soccer there is a negative relationship between the amount of shots on goals teams concede and the results of their games. Maryland is right around the national average for now, using an improved defense to slightly outscore opponents. Can they keep that up against tougher B1G opponents? Probably not.




### Residuals

```{r}
matches_2025 <- matches_2025 |> mutate(sog_pct = (so_g/sh_att) * 100, assist_margin = assists-defensive_assists, def_sogpct = (defensive_so_g/defensive_sh_att)*100)
```



```{r}
wsocmodel <- lm(goal_diff ~ sog_pct + assist_margin + defensive_so_g, data=matches_2025)
summary(wsocmodel)
```
I selected shot on goal percentage and defensive shots on goal allowed to try and include standard measures of a team's offensive and defensive efficiency. I added assist margin to try and include a more creative factor to track teams that are more connected than their opponents. 

I'm happy with this model. The R-Squared values are demonstrating that these three factors account for around 80% of goal differential, which is very solid. More than that though I am happy with the very low p-value meaning my results are not random chance.At first I thought I also had a very low residual standard error, but once I realized its on the scale of goals in a soccer match being off by a whole goal is a lot more significant so I actually would like that to be smaller (at least under one).

```{r}
matches_2025 <- matches_2025 |> filter(!is.na(sog_pct))

matches_2025 <- matches_2025 |> mutate(predicted = predict(wsocmodel), residuals = residuals(wsocmodel))
```


```{r}
matches_2025 |> arrange(desc(residuals)) |> select(date, team, opponent, outcome, goal_diff, assist_margin, sog_pct, defensive_so_g, predicted, residuals)
```

```{r}
matches_2025 |> arrange(residuals) |> select(date, team, opponent, outcome, goal_diff, assist_margin, sog_pct, defensive_so_g, predicted, residuals)
```

I am glad to see that my residuals are often occuring in matches where the model predicted a relatively lopsided game like a win or loss by 3 + goals, and the game went that way, but was even more lopsided. I wouldn't really expect or want a soccer model to predict outcomes to be over five goals, because even in mismatches that's pretty hard to achieve. It also shows some of the potential problems with using shot on goal percentage as a predictor, because if you're getting such a high volume of shots on a team and missing a lot you can still outscore them by a lot just by pelting shots at them.

```{r}
matches_2025 |> arrange(desc(residuals)) |> filter(team=='Maryland Terrapins, Terps')|> select(date, team, opponent, outcome, goal_diff, assist_margin, sog_pct, defensive_so_g, predicted, residuals)
```

I think that if I was covering Maryland women's soccer I could use the information from these residuals in my coverage, but maybe not a full story. I would focus on their recent road trip to the west coast where they took two losses to USC and UCLA. UCLA is No. 4 in the country and the Terps lost by just a goal, while USC beat them by 3. 
In both games though the model actually predicted a better result, in the UCLA game just barely, but in the USC game it predicted they would lose by just under a goal instead of the three that they did lose by, the second highest absolute value of any of their residuals.
It's very common to see soccer coaches in particular say after a game "we deserved a better result than we got", "I thought the result was fair", or even sometimes "we were fortunate". I don't know if Marchiano engages in these kinds of quotes, but if he does this model would inform that they actually probably did deserve a bit more from the USC, and they really did play the UCLA game close.
Essentially I think you could use this data to show that things that despite an 0-2 road trip, there are still some positives for the team.


I think the UCLA result is the overall most surprising part of this analysis and honestly represents a really big step forward for the program. I think if I had a lot of time on my hands I would write a story on what the Terps did well in that game and how they can repeat it to try and pick up more positive results in conference. At face value that idea seems a little weird considering they lost, but in context of how bad they've been in the Big Ten and against the best teams in the country I think it would be a worthwhile article.


## Z- Score


```{r}
teamquality <- matches_2025 |> 
  mutate(sog_pct = so_g/sh_att, def_sog_pct = defensive_so_g/defensive_sh_att) |> 
  filter(!is.na(sog_pct), !is.na(def_sog_pct)) |> 
  group_by(team) |> 
  summarise(
    avg_goals = mean(goals),
    avg_def_goals = mean(defensive_goals),
    avg_sog_pct = mean(sog_pct),
    avg_def_sog_pct = mean(def_sog_pct),
    avg_assists = mean(assists),
    avg_def_assists = mean(defensive_assists)
  )

teamzscore <- teamquality |> 
  mutate(
    goalsZscore = as.numeric(scale(avg_goals, center = TRUE, scale = TRUE)),
    defgoalsZscore = as.numeric(scale(avg_def_goals, center = TRUE, scale = TRUE)) * -1,
    sogpctZscore = as.numeric(scale(avg_sog_pct, center = TRUE, scale = TRUE)),
    defsogpctZscore = as.numeric(scale(avg_def_sog_pct, center = TRUE, scale = TRUE)) * -1,
    assistsZscore = as.numeric(scale(avg_assists, center = TRUE, scale = TRUE)),
    defassistsZscore = as.numeric(scale(avg_def_assists, center = TRUE, scale = TRUE)) * -1,
    TotalZscore = goalsZscore + defgoalsZscore + sogpctZscore + defsogpctZscore + assistsZscore + defassistsZscore
  ) 
```

