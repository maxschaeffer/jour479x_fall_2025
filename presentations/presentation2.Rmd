---
title: "presentation2"
output: html_document
---

All the following code summarizes my attempts to just get a clean dataframe that is isolating tournament games and then. within that tournament games where upsets occur. That has proved a lot more difficult then I expected. I tried a bunch of different resources I found online as well as loading the game logs we've used in class.

There is some data online at a resource called Kaggle that seemingly has tournament-specific detailed game logs available, but despite multiple attempts I couldn't find any way to download it. What I need is just data that specifies whether games are in the tournament or not and preferably team's seeds so I could set filters for tournament games where a seed low enough beats a seed high enough then start looking at stats.

The best I was able to do was use the game log data we have from class, and set teams into classifications of Power6 + Gonzaga and then everybody else as mid-major. From there I was able to make a dataframe where in the date range of when the tournament is typically going on a mid-major beat a powersix team. 

There are some obvious problems with this method, the biggest one being that this is going to include not just games in the NCAA tournament, but other postseason tournaments like the CBI or NIT which I don't care about. Additionally, a powersix team losing to a mid-major doesn't guarantee it was an upset. My biggest question is do you have a dataset that you think would be better that I can use? If not, should I proceed with my upset dataframe or pivot to a different idea using CBB game logs? 

```{r}
library(tidyverse)
library(hoopR)
library(lubridate)
library(purrr)
library(tidyr)
```



```{r}
logs <- read_csv("https://thescoop.org/sports-data-files/cbblogs1526.csv")
mbb_pbp <- hoopR::load_mbb_pbp()
boxes <- hoopR::load_mbb_team_box() 
```

```{r}
logs$Date <- as.Date(logs$Date)
marchgames <- logs |> 
  filter(
    (month(Date) == 3 & day(Date) >= 10) |  
    (month(Date) == 4 & day(Date) <= 30)     
  )
```


```{r}

power6 <- c(
  "ACC", "ACC MBB", "Big Ten", "Big Ten MBB", "Big 12", "Big 12 MBB", "SEC", "SEC MBB", "Pac-12", "Pac-12 MBB", "Big East", "Big East MBB", "Gonzaga"
)

extra_power <- c(
"Brigham Young",  "Central Florida", "Cincinnati", "Connecticut", 
  "Houston", "Memphis", "Oregon State", 
  "Southern Methodist", "UCF", "Washington State"
)


logs <- logs |>  
  mutate(
    Classification = if_else(
      Conference %in% power6 | Team %in% extra_power,
      "Power",
      "Mid-Major"
    )
  )
```


```{r}
classifications <- logs |> 
  group_by(Team) |> 
  summarize(Classification = first(Classification), .groups = "drop")

logs <- logs |> 
  select(-matches("Classification_team|Classification_opp")) |> 
  left_join(classifications, by = "Team", suffix = c("", "_team")) |> 
  left_join(classifications, by = c("Opponent" = "Team"), suffix = c("", "_opp"))


upsets <- logs |> 
  filter(Classification_team == "Mid-Major",
         Classification_opp == "Power",
         W_L == "W")

upsets <- upsets |> 
  distinct(Team, Opponent, Date, .keep_all = TRUE)
```

```{r}
upsets <- upsets |> 
  dplyr::select(Team, everything())
```


```{r}
upsets_avgs <- upsets |> 
  summarise(
    avgfgpct = mean(TeamFGPCT)
    avg
  )
```

I had a very difficult and long battle with my code to figure out what was causing some of the problems. First I tried to use the sports betting hoopR (I deleted the code form my attempts), but it doesn't have a data frame that features the lines just team box scores and then a feature that can call the line for a game if you feed it the ID. 

I tried to use AI to stitch that on top of the full box score data frame, but was unsuccesful and almost crashed my R. I returned to my original plan of using mid-major team's defeating power-conference teams and removed my previous March filter(per your advice)

This still lead to a range of problems in my data, like certain teams that had multiple identifiers and didn't go in their proper categories and then individual games being counted numeerous times. Eventually I was able to trouble shoot all of those.

I now finally have a bunch of stats, that I want to compare the performance of winning teams in upsets to vs. the overall average from our complete logs. If I come across multiple stats where there's a significant outperformance of the average by team's in upsets, I was thinking I'd create a dumbell plot to demonstrate the difference. If I just have one or two maybe just a simpler stacked bar chart. 

Then I was going to create a model and look at some of the biggest residuals for my upset games, my question is what kind of data visualization should I build off that. You metnioned a scatterplot, but I'm not picturing exactly how that played out.

Lastly, I'm going to put together a visualizatoin to show the teams that have the most upsets vs. have been upset the most. I know that's not what you want my project to be principally focused on, but think it will be a fun thing to include and can contribute to my story.






