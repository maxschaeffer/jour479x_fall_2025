---
title: "presentation2"
output: html_document
---

All the following code summarizes my attempts to just get a clean dataframe that is isolating tournament games and then. within that tournament games where upsets occur. That has proved a lot more difficult then I expected. I tried a bunch of different resources I found online as well as loading the game logs we've used in class.

There is some data online at a resource called Kaggle that seemingly has tournament-specific detailed game logs available, but despite multiple attempts I couldn't find any way to download it. What I need is just data that specifies whether games are in the tournament or not and preferably team's seeds so I could set filters for tournament games where a seed low enough beats a seed high enough then start looking at stats.

The best I was able to do was use the game log data we have from class, and set teams into classifications of Power6 + Gonzaga and then everybody else as mid-major. From there I was able to make a dataframe where in the date range of when the tournament is typically going on a mid-major beat a powersix team. 

There are some obvious problems with this method, the biggest one being that this is going to include not just games in the NCAA tournament, but other postseason tournaments like the CBI or NIT which I don't care about. Additionally, a powersix team losing to a mid-major doesn't guarantee it was an upset. My biggest question is do you have a dataset that you think would be better that I can use? If not, should I proceed with my upset dataframe or pivot to a different idea using CBB game logs? 

```{r}
library(tidyverse)
library(hoopR)
library(lubridate)
```



```{r}
logs <- read_csv("https://thescoop.org/sports-data-files/cbblogs1526.csv")
mbb_pbp <- hoopR::load_mbb_pbp()
boxes <- hoopR::load_mbb_team_box() 
```

```{r}
logs$Date <- as.Date(logs$Date)
marchgames <- logs |> 
  filter(
    (month(Date) == 3 & day(Date) >= 10) |  
    (month(Date) == 4 & day(Date) <= 30)     
  )
```


```{r}
power6 <- c(
  "ACC", "ACC MBB", "Big Ten", "Big Ten MBB", "Big 12", "Big 12 MBB", "SEC", "SEC MBB", "Pac-12", "Pac-12 MBB", "Big East", "Big East MBB", "Gonzaga"
)

marchgames <- marchgames|> 
  mutate(
    Classification = if_else(
      Conference %in% power6 | Team == "Gonzaga",
      "Power",
      "Mid-Major"
    )
  )
```


```{r}
classifications <- marchgames |> 
  distinct(Team, Classification)

marchgames <- marchgames |> 
  left_join(classifications, by = "Team", suffix = c("", "_team")) |> 
  left_join(classifications, by = c("Opponent" = "Team"), suffix = c("", "_opp"))


upsets <- marchgames |> 
  filter(Classification_team == "Mid-Major",
         Classification_opp == "Power",
         W_L == "W")
```
```{r}
names(marchgames)
```

```{r}
twentyfive <- read_csv("team_box_2025.csv")
twentyfour <- read_csv("team_box_2024.csv")
twentythree <- read_csv("team_box_2023.csv")
twentytwo <- read_csv("team_box_2022.csv")
twentyone<- read_csv("team_box_2021.csv")
nineteen <- read_csv("team_box_2019.csv")
eighteen <- read_csv("team_box_2018.csv")
seventeen <- read_csv("team_box_2017.csv")
sixteen <- read_csv("team_box_2016.csv")
fifteen <- read_csv("team_box_2015.csv")
```

```{r}
last10 <- list(
  fifteen,
  sixteen,
  seventeen,
  eighteen,
  nineteen,
  twentyone,
  twentytwo,
  twentythree,
  twentyfour,
  twentyfive
)

last10 <- bind_rows(last10)
postseason <- last10 |> filter(season_type == "3")
```


I was able to attempt Derek's suggestion of loading in the Sportsverse data which has the identifier of a post vs regular season game, which I'm direly missing in the other dataset. There are two main problems with this one though. A. it's one sided data, so I couldn't do comparative stats like turnover or rebounding margin. There might be a fix where I can combine the two since the rows of the teams that played each other are stacked on top of each other in the data. The other problem is not only is there no seed data, there's no conference data so I can't even filter for mid-majors beating P6s like I did in my previous data. 

Do you think there's a solution to this or should I resort back to your other suggestion and just do all upsets of mid-majors over p6s using my first dataset. I'm leaning toward the second option, but if you think there's a good solution for the Sportsverse data I'm 100% open.

As far as data visualization one that I think I could do is a dumbell chart. The chart would be titled something like "How do college basketball upsets happen?" Then I would compare the performance of the upseting team in certain statistical categories vs. the national average in that same category. I would order it in descending order from the largest margin over the average to show which stats are the most relevant and then less necessary for an upset from there. 

